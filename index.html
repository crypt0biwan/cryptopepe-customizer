<html>
    <head>
        <title>
            CryptoPepe customizer
        </title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

        <style type="text/css">
            body { padding-bottom: 200px; }

            svg { max-width: 100%; }
        </style>
    </head>

    <body>
        <div class="container pt-4">
            <div class="row">
                <div class="col-md-6 pt-4">
                    <h3 class="mb-3">Select the desired traits to create your custom CryptoPepe</h3>

                    <form>
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="shirt_select" class="col-form-label">Shirt</label>
                            </div>
                            <div class="col-md-9">
                                <select id="shirt_select" class="form-select" aria-label="Default select example">
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="eyes_select" class="col-form-label">Eyes</label>
                            </div>
                            <div class="col-md-9">
                                <select id="eyes_select" class="form-select" aria-label="Default select example">
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="hair_select" class="col-form-label">Hair</label>
                            </div>
                            <div class="col-md-9">
                                <select id="hair_select" class="form-select" aria-label="Default select example">
                                    <option value="">None</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="glasses_select" class="col-form-label">Glasses</label>
                            </div>
                            <div class="col-md-9">
                                <select id="glasses_select" class="form-select" aria-label="Default select example">
                                    <option value="">None</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="mouth_select" class="col-form-label">Mouth</label>
                            </div>
                            <div class="col-md-9">
                                <select id="mouth_select" class="form-select" aria-label="Default select example">
                                    <option value="">None</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="neck_select" class="col-form-label">Neck</label>
                            </div>
                            <div class="col-md-9">
                                <select id="neck_select" class="form-select" aria-label="Default select example">
                                    <option value="">None</option>
                                </select>
                            </div>
                        </div>
                    </form>

                </div>

                <div class="col">
                    <img id="builder-img">
                </div>
            </div>
        </div>

        <script>
            let colors = []

            const parts = {
                "general": [
                    {
                        "back": "Background.svg",
                        "id": "background",
                        "name": "background",
                        "colors": {
                            "background_color": "#E6E6E6"
                        }
                    },
                    {
                        "back": "HeadBack.svg",
                        "front": "HeadFront.svg",
                        "id": "head",
                        "name": "head",
                        "colors": {
                                "skin_color": "#68984E"
                        }
                    }
                ],
                "eyes": [
                    {
                        "back": "Colored Eyes.svg",
                        "id": "colored_eyes",
                        "name": "colored eyes",
                        "colors": {
                        "Head.Eyes.EyeColor": "#0B4AA8"
                        }
                    },
                    {
                        "back": "Ethereum Eyes.svg",
                        "id": "ethereum_eyes",
                        "name": "Ethereum eyes"
                    },
                    {
                        "back": "Money Eyes.svg",
                        "id": "money_eyes",
                        "name": "$$ eyes"
                    },
                    {
                        "back": "Closed Eyes 2.svg",
                        "id": "closed_eyes_2",
                        "name": "closed eyes 2",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Closed Eyes.svg",
                        "id": "closed_eyes",
                        "name": "closed eyes",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Crying Eyes 2.svg",
                        "id": "crying_eyes_2",
                        "name": "crying eyes 2",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Crying Eyes.svg",
                        "id": "crying_eyes",
                        "name": "crying eyes"
                    },
                    {
                        "back": "Half Closed Eyes.svg",
                        "id": "half_closed_eyes",
                        "name": "half closed eyes",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Mad Eyes.svg",
                        "id": "mad_eyes",
                        "name": "mad eyes",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Red Eyes.svg",
                        "id": "red_eyes",
                        "name": "red eyes"
                    },
                    {
                        "back": "Small Eyes.svg",
                        "id": "small_eyes",
                        "name": "small eyes"
                    },
                    {
                        "back": "Wide Eyes.svg",
                        "id": "wide_eyes",
                        "name": "wide eyes",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Alien Eyes and Nose.svg",
                        "id": "alien_eyes",
                        "name": "alien eyes",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Ghandi Pepe.svg",
                        "id": "ghandi",
                        "name": "Ghandi",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "Illuminati Eye.svg",
                        "id": "illuminati_eye",
                        "name": "illuminati eye"
                    },
                    {
                        "back": "Smug Eyes.svg",
                        "id": "smug_eyes",
                        "name": "Smug eyes",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "FutureRobotEyes.svg",
                        "id": "future_robot_eyes",
                        "name": "Future Robot eyes",
                        "colors": {
                        "Extra.Glasses.PrimaryColor": "#3a60ff",
                        "Extra.Glasses.SecondaryColor": "#2392ff"
                        }
                    },
                    {
                        "back": "MonkasEye.svg",
                        "id": "monkas_eye",
                        "name": "Monkas Eye"
                    },
                    {
                        "back": "ScaryEyes.svg",
                        "id": "scary_eyes",
                        "name": "Scary eyes"
                    },
                    {
                        "back": "WokeEyes.svg",
                        "id": "woke_eyes",
                        "name": "Woke eyes",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "back": "LolEyes.svg",
                        "id": "lol_eyes",
                        "name": "LOL Eyes",
                        "colors": {
                        "Head.Eyes.EyeColor": "#ff0000"
                        }
                    }
                ],
                "glasses": [
                    {
                        "front": "SmartGlasses.svg",
                        "id": "smart_glasses",
                        "name": "smartglasses",
                        "colors": {
                        "Extra.Glasses.SecondaryColor": "#CCCCCC"
                        }
                    },
                    {
                        "front": "Sunglasses 1.svg",
                        "id": "sunglasses_1",
                        "name": "sunglasses 1",
                        "colors": {
                        "Extra.Glasses.PrimaryColor": "#ff0000",
                        "Extra.Glasses.SecondaryColor": "#4D4D4D"
                        }
                    },
                    {
                        "front": "Sunglasses 2.svg",
                        "id": "sunglasses_2",
                        "name": "sunglasses 2",
                        "colors": {
                        "Extra.Glasses.PrimaryColor": "#1A1A1A",
                        "Extra.Glasses.SecondaryColor": "#ADADAD"
                        }
                    },
                    {
                        "front": "Thug Life Glasses.svg",
                        "id": "thuglife",
                        "name": "Thug Life glasses",
                        "colors": {
                        "Extra.Glasses.PrimaryColor": "#000044",
                        "Extra.Glasses.SecondaryColor": "#FFFFFF"
                        }
                    },
                    {
                        "front": "Pirate.svg",
                        "id": "pirate_hat",
                        "name": "pirate_hat",
                        "colors": {
                        "Extra.Glasses.PrimaryColor": "#666666",
                        "Extra.Glasses.SecondaryColor": "#7F0502"
                        }
                    },
                    {
                        "front": "ExplosionGoggles.svg",
                        "id": "explosion_goggles",
                        "name": "Explosion Goggles"
                    },
                    {
                        "front": "FutureGlasses.svg",
                        "id": "future_glasses",
                        "name": "Future glasses"
                    },
                    {
                        "front": "KimJongUnGlasses.svg",
                        "id": "kim_jong_un_glasses",
                        "name": "Kim Jong Un glasses"
                    },
                    {
                        "front": "VRSet.svg",
                        "id": "vr_set",
                        "name": "VRSet"
                    }
                ],
                "hair": [
                    {
                        "front": "70s Hair.svg",
                        "id": "70s_hair",
                        "name": "70s hair",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "Elvis Hair.svg",
                        "id": "elvis_hair",
                        "name": "Elvis hair",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "Goku Hair.svg",
                        "id": "goku_hair",
                        "name": "Goku hair",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "Modern Hair.svg",
                        "id": "modern_hair",
                        "name": "modern hair",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "Nerd Hair.svg",
                        "id": "nerd_hair",
                        "name": "nerd hair",
                        "colors": {
                            "hair_color": "#78391E"
                        }
                    },
                    {
                        "front": "Trump Hair.svg",
                        "id": "trump_hair",
                        "name": "Trump hair",
                        "colors": {
                            "hair_color": "#E4B833"
                        }
                    },
                    {
                        "front": "Bitcoin Cap.svg",
                        "id": "bitcoin_cap",
                        "name": "Bitcoin cap",
                        "colors": {
                            "hat_color": "#F99F30",
                            "hat_color2": "#AD661F"
                        }
                    },
                    {
                        "front": "Mine Hat.svg",
                        "id": "mine_hat",
                        "name": "Miner hat",
                        "colors": {
                            "hat_color": "#CCCCCC"
                        }
                    },
                    {
                        "front": "Bandana.svg",
                        "id": "bandana",
                        "name": "bandana",
                        "colors": {
                            "hat_color": "#ff0000"
                        }
                    },
                    {
                        "front": "Beanie.svg",
                        "id": "beanie",
                        "name": "beanie",
                        "colors": {
                            "hat_color": "#5B3B3B"
                        }
                    },
                    {
                        "front": "Hat.svg",
                        "id": "hat",
                        "name": "hat",
                        "colors": {
                            "hat_color": "#3E4E5C"
                        }
                    },
                    {
                        "front": "Hat 2.svg",
                        "id": "hi_hat",
                        "name": "High hat",
                        "colors": {
                            "hat_color2": "#D91F26"
                        }
                    },
                    {
                        "front": "Mining Cap.svg",
                        "id": "mining_cap",
                        "name": "Mining cap"
                    },
                    {
                        "front": "Mohawk.svg",
                        "id": "mohawk",
                        "name": "mohawk",
                        "colors": {
                            "hat_color2": "#ff0000"
                        }
                    },
                    {
                        "front": "Mohawk.svg",
                        "id": "mohawk",
                        "name": "mohawk",
                        "colors": {
                            "hat_color2": "#ff0000"
                        }
                    },
                    {
                        "front": "Terrorist.svg",
                        "id": "terrorist",
                        "name": "terrorist"
                    },
                    {
                        "front": "Thug Life Cap.svg",
                        "id": "thug_life_cap",
                        "name": "Thug Life cap"
                    },
                    {
                        "front": "Wig.svg",
                        "id": "wig",
                        "name": "wig",
                        "colors": {
                            "hat_color": "#ff0000"
                        }
                    },
                    {
                        "front": "big_bun.svg",
                        "id": "big_bun",
                        "name": "big bun",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "bun_beard.svg",
                        "id": "bun_beard",
                        "name": "bun & beard",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "cowboy_hat.svg",
                        "id": "cowboy_hat",
                        "name": "cowboy hat",
                        "colors": {
                            "hat_color2": "#ac693c",
                            "hat_color": "#825a5d",
                            "hair_color": "#00ff00"
                        }
                    },
                    {
                        "front": "old_bun.svg",
                        "id": "old_bun",
                        "name": "oldschool bun",
                        "colors": {
                            "hair_color": "#864646"
                        }
                    },
                    {
                        "front": "spike_hair.svg",
                        "id": "spike_hair",
                        "name": "spikes",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "two_braids.svg",
                        "id": "two_braids",
                        "name": "double braids",
                        "colors": {
                            "hair_color": "#ffd942"
                        }
                    },
                    {
                        "back": "pharaoh_back.svg",
                        "front": "pharaoh_front.svg",
                        "id": "pharaoh",
                        "name": "pharaoh",
                        "colors": {
                            "hat_color2": "#ff0000"
                        }
                    },
                    {
                        "front": "Chaplin.svg",
                        "id": "chaplin",
                        "name": "Chaplin"
                    },
                    {
                        "front": "EgyptianHat.svg",
                        "id": "egyptian_hat",
                        "colors": {
                            "hat_color2": "#437dc0",
                            "hat_color": "#4353c0"
                        }
                    },
                    {
                        "front": "Frankenstein.svg",
                        "back": "Frankenstein_back.svg",
                        "id": "frankenstein",
                        "name": "Frankenstein"
                    },
                    {
                        "front": "IndianHat.svg",
                        "back": "IndianHat_back.svg",
                        "id": "indian_hat",
                        "name": "Indian Hat",
                        "colors": {
                            "hat_color2": "#ffbd35",
                            "hat_color": "#ff6819",
                        "Extra.Glasses.PrimaryColor": "#ffed31"
                        }
                    },
                    {
                        "front": "KimJongUnHair.svg",
                        "id": "kim_jong_un_hair",
                        "name": "Kim Jong Un Hair"
                    },
                    {
                        "front": "KnifeThroughHead.svg",
                        "back": "KnifeThroughHead_back.svg",
                        "id": "knife_through_head",
                        "name": "Knife Through Head"
                    },
                    {
                        "front": "Mcafee.svg",
                        "id": "mcafee",
                        "name": "John McAfee",
                        "colors": {
                            "hair_color": "#f5e392"
                        }
                    },
                    {
                        "front": "MinerHat2.svg",
                        "id": "minerhat2",
                        "name": "Miner Hat2"
                    },
                    {
                        "front": "Nakamoto.svg",
                        "back": "Nakamoto_back.svg",
                        "id": "nakamoto",
                        "name": "Nakamoto"
                    },
                    {
                        "front": "Nun.svg",
                        "back": "Nun_back.svg",
                        "id": "nun",
                        "name": "Nun"
                    },
                    {
                        "front": "PaperHat.svg",
                        "id": "paper_hat",
                        "name": "Paper Hat"
                    },
                    {
                        "front": "Rollers.svg",
                        "back": "Rollers_back.svg",
                        "id": "rollers",
                        "name": "Rollers",
                        "colors": {
                            "hair_color": "#8d3d26",
                            "hat_color2": "#eb2626"
                        }
                    },
                    {
                        "front": "Samurai.svg",
                        "back": "Samurai_back.svg",
                        "id": "samurai",
                        "name": "Samurai",
                        "colors": {
                            "hat_color2": "#00f"
                        }
                    },
                    {
                        "front": "SombreroHat.svg",
                        "id": "sombrero_hat",
                        "name": "Sombrero Hat"
                    },
                    {
                        "front": "TinFoilAntennaHat.svg",
                        "back": "TinFoilAntennaHat_back.svg",
                        "id": "tinfoil_antenna_hat",
                        "name": "Tin Foil Antenna Hat"
                    },
                    {
                        "front": "TurkishHat.svg",
                        "id": "turkish_hat",
                        "name": "Turkish Hat"
                    },
                    {
                        "front": "UASFHat.svg",
                        "back": "UASFHat_back.svg",
                        "id": "uasf_hat",
                        "name": "UASFHat"
                    },
                    {
                        "front": "CryptoPepesHat.svg",
                        "back": "UASFHat_back.svg",
                        "id": "cpep_uasf_hat",
                        "name": "CryptoPepes (UASF style)"
                    },
                    {
                        "front": "VikingHat.svg",
                        "id": "viking_hat",
                        "name": "Viking Hat"
                    },
                    {
                        "front": "WizardHat.svg",
                        "id": "wizard_hat",
                        "name": "Wizard Hat"
                    },
                    {
                        "front": "vitalik_hair_front.svg",
                        "back": "vitalik_hair_back.svg",
                        "id": "vitalik_hair",
                        "name": "Vitalik Hair",
                        "colors": {
                            "skin_color": "#68984e"
                        }
                    }
                ],
                "mouth": [
                    {
                        "front": "Basic Lips.svg",
                        "id": "basic_lips",
                        "name": "basic lips"
                    },
                    {
                        "front": "Cool Smile.svg",
                        "id": "cool_smile",
                        "name": "cool smile"
                    },
                    {
                        "front": "Crying Lips.svg",
                        "id": "crying_lips",
                        "name": "crying lips"
                    },
                    {
                        "front": "Extreme Sad Lips.svg",
                        "id": "extreme_sad_lips",
                        "name": "extreme sad lips"
                    },
                    {
                        "front": "Fake Smile.svg",
                        "id": "fake_smile",
                        "name": "fake smile"
                    },
                    {
                        "front": "Happy Lips.svg",
                        "id": "happy_lips",
                        "name": "happy lips"
                    },
                    {
                        "front": "Lips to Kiss.svg",
                        "id": "lips_to_kiss",
                        "name": "lips to kiss"
                    },
                    {
                        "front": "Mad Lips 2.svg",
                        "id": "mad_lips_2",
                        "name": "mad lips 2"
                    },
                    {
                        "front": "Mad Mouth.svg",
                        "id": "mad_mouth",
                        "name": "mad mouth"
                    },
                    {
                        "front": "Open Mouth.svg",
                        "id": "open_mouth",
                        "name": "open mouth"
                    },
                    {
                        "front": "Sad Lips 2.svg",
                        "id": "sad_lips_2",
                        "name": "sad lips 2"
                    },
                    {
                        "front": "Smiling Lips.svg",
                        "id": "smiling_lips",
                        "name": "smiling lips"
                    },
                    {
                        "front": "Surprised Mouth.svg",
                        "id": "surprised_mouth",
                        "name": "surprised mouth"
                    },
                    {
                        "front": "Tongue Out.svg",
                        "id": "tongue_out",
                        "name": "tongue out",
                        "colors": {
                        "background_color": "#E6E6E6"
                        }
                    },
                    {
                        "front": "What Mouth.svg",
                        "id": "what_mouth",
                        "name": "what mouth",
                        "colors": {
                        "background_color": "#E6E6E6"
                        }
                    },
                    {
                        "front": "Wide Mouth.svg",
                        "id": "wide_mouth",
                        "name": "wide mouth"
                    },
                    {
                        "front": "Wtf Mouth.svg",
                        "id": "wtf_mouth",
                        "name": "WTF mouth"
                    },
                    {
                        "front": "Young Lips.svg",
                        "id": "young_lips",
                        "name": "young lips"
                    },
                    {
                        "front": "Smug Lips.svg",
                        "id": "smug_lips",
                        "name": "smug lips",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "front": "braces.svg",
                        "id": "braces",
                        "name": "braces"
                    },
                    {
                        "front": "rabbit_teeth.svg",
                        "id": "rabbit_teeth",
                        "name": "rabbit teeth"
                    },
                    {
                        "front": "bad_ass_mouth.svg",
                        "id": "bad_ass_mouth",
                        "name": "bad ass mouth",
                        "colors": {
                            "hair_color": "#ff0000"
                        }
                    },
                    {
                        "front": "SmugMustache.svg",
                        "id": "smug_mustache",
                        "name": "Smug Mustache",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "front": "DrinkCoffee.svg",
                        "id": "drink_coffee",
                        "name": "Drink Coffee",
                        "colors": {
                            "skin_color": "#68984e"
                        }
                    },
                    {
                        "front": "DrinkWine.svg",
                        "id": "drink_wine",
                        "name": "Drink Wine",
                        "colors": {
                            "skin_color": "#68984e"
                        }
                    },
                    {
                        "front": "FeelsBirthday.svg",
                        "id": "feels_birthday",
                        "name": "Feels Birthday"
                    },
                    {
                        "front": "OldSadMouth.svg",
                        "id": "old_sad_mouth",
                        "name": "Old Sad Mouth"
                    },
                    {
                        "front": "LolMouth.svg",
                        "id": "lol_mouth",
                        "name": "LOL Mouth"
                    }
                ],
                "neck": [
                    {
                        "back": "Choker Necklace.svg",
                        "id": "choker_necklace",
                        "name": "choker necklace"
                    },
                    {
                        "back": "Dollar Necklace.svg",
                        "id": "dollar_necklace",
                        "name": "dollar necklace"
                    },
                    {
                        "back": "Punk Necklace.svg",
                        "id": "punk_necklace",
                        "name": "punk necklace"
                    },
                    {
                        "back": "cowboy_neck.svg",
                        "id": "cowboy_neck",
                        "name": "cowboy scarf"
                    }
                ],
                "shirt": [
                    {
                        "back": "Basic Shirt.svg",
                        "id": "basic_shirt",
                        "name": "basic shirt",
                        "colors": {
                            "shirt_color": "#2249FC"
                        }
                    },
                    {
                        "back": "Camp Shirt.svg",
                        "id": "camp_shirt",
                        "name": "camp shirt",
                        "colors": {
                            "shirt_color": "#FFFFFF"
                        }
                    },
                    {
                        "back": "Suit and tie.svg",
                        "id": "suit",
                        "name": "Suit and tie",
                        "colors": {
                            "shirt_color": "#DD0000"
                        }
                    },
                    {
                        "back": "Darth Pepe.svg",
                        "id": "darth_pepe",
                        "name": "darth pepe"
                    },
                    {
                        "back": "KimJongUnShirt.svg",
                        "id": "kim_jong_un_shirt",
                        "name": "Kim Jong Un Shirt"
                    },
                    {
                        "back": "MexicanPoncho.svg",
                        "id": "mexican_poncho",
                        "name": "Mexican Poncho",
                        "colors": {
                            "skin_color": "#68984E"
                        }
                    },
                    {
                        "front": "Pepemon.svg",
                        "back": "Pepemon_back.svg",
                        "id": "pepemon",
                        "name": "Pepemon"
                    },
                    {
                        "front": "Dracula.svg",
                        "back": "DraculaBack.svg",
                        "id": "dracula",
                        "name": "Dracula Suit"
                    },
                    {
                        "back": "vitalik_shirt_back.svg",
                        "front": "vitalik_shirt_front.svg",
                        "id": "vitalik_shirt",
                        "name": "Vitalik Shirt",
                        "colors": {
                                "skin_color": "#68984e"
                        }
                    }
                ]
            }

            const parser = new DOMParser()
            const s = new XMLSerializer()

            function setImageToSVG(img, svg) {
                img.src = "data:image/svg+xml;charset=utf-8,"+svg.replace(/(\r\n|\n|\r)/gm, "").replace(/>\s+</g,'><');
            }

            async function getSVG(path) {
                const response = await fetch(`./pepe-svg-art/${path}`)
                const data = await response.text()
                return data
            }

            async function getPart(category, file) {
                const res = await getSVG(`${category}/${file}`)
                let doc = parser.parseFromString(res, "image/svg+xml")
                return s.serializeToString(doc.querySelector('svg g'))
            }

            function setColors(item_colors) {
                Object.keys(item_colors).forEach(key => {
                    colors[key] = item_colors[key]
                })
            }

            function filterPart(key, id) {
                const arr = Object.keys(parts).filter((key) => key.includes(key)).reduce((cur, key) => { return Object.assign(cur, { [key]: parts[key] })}, {})[key]

                if(id) {
                    const item = arr.filter(i => i.id === id)[0]

                    if(item.colors) {
                        console.log('colors!', item.colors)

                        setColors(item.colors)
                    }

                    return item
                }

                return arr
            }

            function prefillSelect(key) {
                const select = document.querySelector(`#${key}_select`)
                const options = filterPart(key)

                console.log(options, options.sort(function(a, b) {
                    if(a.name && b.name) {
                        var x = a.name.toLowerCase();
                        var y = b.name.toLowerCase();
                        return x < y ? -1 : x > y ? 1 : 0;
                    } else {
                        return 1
                    }
                }))
                
                options.forEach(option => {
                    const { id, name } = option
                    select.innerHTML += `<option value="${id}">${name}</option>`
                })
            }

            function prefillForm() {
                prefillSelect('eyes')
                prefillSelect('glasses')
                prefillSelect('hair')
                prefillSelect('mouth')
                prefillSelect('neck')
                prefillSelect('shirt')
            }

            async function init () {
                colors['background_color'] = '#d4c8de'
                colors['skin_color'] = '#72a657'
                colors['shirt_color'] = '#4fb68b'
                colors['hair_color'] = '#000000'

                // let background_color = '#d4c8de'
                // let skin_color = '#72a657'
                // let shirt_color = '#4fb68b'
                // let hair_color = '#000000'

                let background = ''
                let shirt_back = ''
                let shirt_front = ''
                let head_back = ''
                let head_front = ''
                let eyes = ''
                let mouth = ''
                let neck = ''
                let hair_front = ''
                let hair_back = ''
                let glasses = ''

                let selected_shirt = filterPart('shirt', document.querySelector('#shirt_select').value)
                let selected_eyes = filterPart('eyes', document.querySelector('#eyes_select').value)
                let selected_hair = {}
                let selected_glasses = {}
                let selected_mouth = {}

                background = await getPart('general', filterPart('general', 'background').back)
                

                if(selected_shirt.front) {
                    shirt_front = await getPart('shirt', selected_shirt.front)
                    shirt_front = shirt_front.replace(/\#2249FC/gim, colors['shirt_color'])
                }

                if(selected_shirt.back) {
                    shirt_back = await getPart('shirt', selected_shirt.back)
                    shirt_back = shirt_back.replace(/\#2249FC/gim, colors['shirt_color'])
                }
                
                head_back = await getPart('general', filterPart('general', 'head').back)
                
                if(document.querySelector('#neck_select').value !== '') {
                    neck = await getPart('neck', filterPart('neck', document.querySelector('#neck_select').value).back)
                }
                
                head_front = await getPart('general', filterPart('general', 'head').front)
                eyes = await getPart('eyes', selected_eyes.back)
                
                if(document.querySelector('#hair_select').value !== '') {
                    selected_hair = filterPart('hair', document.querySelector('#hair_select').value)

                    if(selected_hair.back) {
                        hair_back = await getPart('hair', selected_hair.front)
                        hair_back = hair_back.replace(/\#ff0000|\#00ff00/gim, colors['hair_color'])
                    }

                    if(selected_hair.front) {
                        hair_front = await getPart('hair', selected_hair.front)
                        hair_front = hair_front.replace(/\#ff0000|\#00ff00/gim, colors['hair_color'])
                    }
                }

                if(document.querySelector('#mouth_select').value !== '') {
                    selected_mouth = filterPart('mouth', document.querySelector('#mouth_select').value)
                    mouth = await getPart('mouth', selected_mouth.front)
                } else {
                    selected_mouth = filterPart('mouth', 'basic_lips')
                    mouth = await getPart('mouth', selected_mouth.front)
                }

                if(selected_mouth) {
                    mouth = mouth.replace(/\#ff0000/gim, colors['hair_color'])
                }
                
                if(document.querySelector('#glasses_select').value !== '') {
                    selected_glasses = filterPart('glasses', document.querySelector('#glasses_select').value)
                    glasses = await getPart('glasses', selected_glasses.front)
                }

                const template = `<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                            x="0px" y="0px" viewBox="0 0 2500 2500">
                    <g>

                    {{ CallTemplate "general>background" . "back" }}

                    {{ CallTemplate "general>background" . "front" }}

                    {{ CallTemplate .Head.Hair.HairType . "back" }}

                    {{ CallTemplate .Body.Shirt.ShirtType . "back" }}

                    {{ CallTemplate .Body.Neck . "back" }}

                    {{ CallTemplate "general>head" . "back" }}
                    {{ CallTemplate "general>head" . "front" }}

                    {{ CallTemplate .Head.Eyes.EyeType . "back" }}

                    {{ CallTemplate .Head.Mouth . "back" }}

                    {{ CallTemplate .Extra.Glasses.GlassesType . "back" }}



                    {{ CallTemplate .Head.Eyes.EyeType . "front" }}

                    {{ CallTemplate .Head.Hair.HairType . "front" }}

                    {{ CallTemplate .Head.Mouth . "front" }}

                    {{ CallTemplate .Body.Shirt.ShirtType . "front" }}

                    {{ CallTemplate .Body.Neck . "front" }}

                    {{ CallTemplate .Extra.Glasses.GlassesType . "front" }}

                    </g>
                </svg>
                {{ end }}

                {{ define "none>back" }}
                    <!-- Explicitly None -->
                {{ end }}

                {{ define "none>front" }}
                <!-- Explicitly None -->
                {{ end }}

                {{ define ">front" }}
                <!-- Implicitly None, for testing -->
                {{ end }}

                {{ define ">back" }}
                <!-- Implicitly None, for testing -->
                {{ end }}


                {{ define "" }}
                    <!-- Fallback -->
                {{ end }}

                {{ define "error>fallback" }}
                    <!-- Missing/Error -->
                {{ end }}
                {{ define "error>fallback>back" }}
                <!-- Missing/Error -->
                {{ end }}
                {{ define "error>fallback>front" }}
                <!-- Missing/Error -->
                {{ end }}

                `


                if(selected_eyes.id === "ghandi") {
                    shirt_back = ''
                    shirt_front = ''
                    glasses = ''
                    hair_back = ''
                    hair_front = ''
                    neck = ''
                    mouth = ''
                }

                if(selected_shirt.id === "darth_pepe") {
                    glasses = ''
                    hair_back = ''
                    hair_front = ''
                    neck = ''
                    // Darth vader has special black skin
                    colors['skin_color'] = "#000000"
                }

                if(selected_shirt.id === "pepemon") {
                    hair_back = ''
                    hair_front = ''
                    neck = ''
                    // Special pika-yellow skin
                    colors['skin_color'] = "#fef135"

                    // Enforce simple lips, red dot next to mouth has to fit
                    if(!selected_mouth.id !== 'simple_mouth') {
                        mouth = await getPart('mouth', filterPart('mouth', 'basic_lips').front)
                    }
                }

                if(selected_glasses.id === 'pirate_hat') {
                    hair_back = ''
                    hair_front = ''
                }

                if(selected_hair.id === 'terrorist') {
                    mouth = ''
                    glasses = ''
                }

                if(selected_hair.id === 'pharaoh') {
                    glasses = ''
                    neck = ''

                    if(selected_eyes.id !== 'simple_eyes') {
                        eyes = await getPart('eyes', filterPart('eyes', 'colored_eyes').back)
                    }
                }

                if(selected_hair.id === 'egyptian_hat') {
                    glasses = ''

                    if(selected_eyes.id !== 'simple_eyes') {
                        eyes = await getPart('eyes', filterPart('eyes', 'colored_eyes').back)
                    }
                }

                if(['future_robot_eyes', 'woke_eyes'].includes(selected_eyes.id)) {
                    glasses = ''
                }    
                
                if(['explosion_goggles', 'vr_set'].includes(selected_glasses.id)) {
                    eyes = ''
                } 

                if(['frankenstein', 'knife_through_head', 'rollers'].includes(selected_glasses.id)) {
                    glasses = ''
                }    
                
                if(selected_eyes.id === 'monkas_eye') {
                    // monkaS has sweat as "hair/hat"
                    hair_back = ''
                    hair_front = ''
                }

                // woke eyes do not fit with upwards caps
                if(['bitcoin_cap', 'thug_life_cap'].includes(selected_hair.id) && selected_eyes.id === 'woke_eyes') {
                    eyes = await getPart('eyes', filterPart('eyes', 'colored_eyes').back)
                }

                if(['chaplin', 'bun_beard', 'mcafee'].includes(selected_hair.id) && selected_mouth.id !== 'simple_mouth') {
                    mouth = await getPart('mouth', filterPart('mouth', 'basic_lips').front)
                }  

                // Vitalik shirt already has hands *vitalik clap*
                if(selected_shirt.id === 'vitalik_shirt'){
                    
                    // mouth = await getPart('mouth', filterPart('mouth', 'basic_lips').front)
                    // eyes = await getPart('eyes', filterPart('eyes', 'ethereum_eyes').back)
                    // hair_back = await getPart('hair', filterPart('hair', 'vitalik_hair').back)
                    // hair_front = await getPart('hair', filterPart('hair', 'vitalik_hair').front)
                    
                    colors['skin_color'] = '#68984E'

                    if(['drink_wine', 'drink_coffee', 'smug_lips', 'smug_mustache'].includes(selected_mouth.id)) {
                        mouth = await getPart('mouth', filterPart('mouth', 'basic_lips').front)
                    }
                }

                // Feelsbirthday already has a pointy party hat.
                if(selected_mouth.id === 'feels_birthday') {
                    hair_back = ''
                    hair_front = ''

                    if(selected_glasses.id === 'pirate_hat') {
                        glasses = ''
                    }
                }                            

                if(['nun', 'samurai'].includes(selected_hair.id)) {
                    glasses = ''
                    shirt_back = ''
                    shirt_front = ''
                }

                const builder_pepe = `
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2500 2500">
                        ${background.replace(/\#E6E6E6/gim, colors['background_color'])}
                        
                        ${shirt_back}

                        ${hair_back}

                        ${head_back.replace(/\#68984E/gim, colors['skin_color'])}

                        ${hair_front}

                        ${shirt_front}

                        ${head_front.replace(/\#68984E/gim, colors['skin_color'])}

                        ${neck}

                        ${eyes.replace(/\#68984E/gim, colors['skin_color'])}

                        ${mouth}

                        ${glasses}

                    </svg>
                `

                let blob = new Blob([builder_pepe], {type: 'image/svg+xml'});
                let url = URL.createObjectURL(blob);
                image = document.querySelector('#builder-img')
                image.src = url;
                image.addEventListener('load', () => URL.revokeObjectURL(url), {once: true});
            }

            prefillForm()

            document.body.addEventListener("change", function(event) {
                if(event.target.classList.contains("form-select")){
                    init()
                }
            })

            init()
        </script>
    </body>
</html>